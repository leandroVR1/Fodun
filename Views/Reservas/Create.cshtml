@model Fodun.Models.ReservaViewModel

<head>
    <link rel="stylesheet" href="~/css/ReservaStyle.css" />
</head>
<form asp-action="Create" asp-controller="Reservas" method="post">
    <div class="form-container">
        <div class="form-content">
            <div class="form-left">
                <h3>Mis Fechas</h3>
                <div class="form-group">
                    <label for="FechaInicio">Fecha de Llegada</label>
                    <input asp-for="FechaInicio" type="date" id="FechaInicio" class="form-control" required />
                    <span asp-validation-for="FechaInicio" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label for="FechaFin">Fecha de Salida</label>
                    <input asp-for="FechaFin" type="date" id="FechaFin" class="form-control" required />
                    <span asp-validation-for="FechaFin" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label for="Noches">Noches</label>
                    <input asp-for="Noches" type="number" id="Noches" class="form-control" min="1" required />
                    <span asp-validation-for="Noches" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label for="NumeroPersonas">Personas</label>
                    <input asp-for="NumeroPersonas" type="number" id="NumeroPersonas" class="form-control" min="1" required />
                    <span asp-validation-for="NumeroPersonas" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label for="Lavanderia">Servicio de Lavandería</label>
                    <input asp-for="Lavanderia" type="checkbox" id="Lavanderia" class="form-control-checkbox" />
                </div>

                <h3>Total Reserva</h3>
                <div class="form-group">
                    <label for="NumeroHabitaciones">Habitaciones</label>
                    <input asp-for="NumeroHabitaciones" type="number" id="NumeroHabitaciones" class="form-control" readonly />
                </div>
                <div class="form-group">
                    <label for="TarifaOrdinaria">Tarifa Día Ordinario</label>
                    <input type="number" id="TarifaOrdinaria" class="form-control" value="0" />
                </div>
                <div class="form-group">
                    <label for="TarifaEspecial">Tarifa Día Especial</label>
                    <input type="number" id="TarifaEspecial" class="form-control" value="0" />
                </div>
                <div class="form-group">
                    <label for="LavanderiaCosto">Lavandería</label>
                    <input asp-for="LavanderiaCosto" type="number" id="LavanderiaCosto" class="form-control" readonly />
                </div>
                <div class="form-group">
                    <label for="ValorTotal">Valor Total</label>
                    <input asp-for="ValorTotal" type="text" id="ValorTotal" class="form-control" readonly />
                </div>
                <button type="submit" class="btn-reservar">Reservar</button>
            </div>

            <div class="form-right">
                @if (Model.Sede != null)
                {
                    <h3>@Model.Sede.Nombre</h3>
                    <div class="sede-description">
                        <img src="@Model.Sede.Imagenes.FirstOrDefault()?.Url" alt="Imagen Sede Recreativa" class="sede-image" />
                        <p>@Model.Sede.Descripcion</p>
                        <div class="image-gallery">
                            @foreach (var imagen in Model.Sede.Imagenes)
                            {
                                <img src="@imagen.Url" alt="Imagen de la Sede" class="gallery-image" />
                            }
                        </div>
                    </div>
                }
                else
                {
                    <p>Sede no disponible.</p>
                }
            </div>
        </div>

        <div class="table-container">
            <h3>Habitaciones / Alojamientos</h3>
            <table class="table-habitaciones">
                <thead>
                    <tr>
                        <th>Detalles</th>
                        <th>Habitación / Alojamiento</th>
                        <th>Capacidad</th>
                        <th>Tarifa día Ordinario</th>
                        <th>Tarifa día Especial</th>
                        <th>Disponibilidad Fecha Seleccionada</th>
                        <th>Ver Calendario Disponibilidad</th>
                        <th>Reservar</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var alojamiento in Model.Alojamientos)
                    {
                        <tr>
                            <td><i class="fas fa-search"></i></td>
                            <td>@alojamiento.NumeroHabitaciones</td>
                            <td>@alojamiento.CapacidadMaxima</td>
                            <td>@alojamiento.ObtenerTarifaOrdinaria()</td>
                            <td>@alojamiento.ObtenerTarifaEspecial()</td>
                            <td>
                                @if (alojamiento.VerificarDisponibilidad(Model.FechaInicio, Model.FechaFin))
                                {
                                    <i class="fas fa-check disponibilidad-icon"></i>
                                }
                                else
                                {
                                    <i class="fas fa-times disponibilidad-icon"></i>
                                }
                            </td>
                            <td><a href="@Url.Action("VerCalendario", new { id = alojamiento.AlojamientoId })"><i class="fas fa-calendar-alt"></i></a></td>
                            <td>
                                <input type="checkbox" name="ReservarHabitacion" value="@alojamiento.AlojamientoId" class="checkbox-habitacion" />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</form>
@section Scripts {
    <script src="~/js/ReservaScript.js"></script>
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.getElementById('FechaInicio').addEventListener('change', calcularTotal);
        document.getElementById('FechaFin').addEventListener('change', calcularTotal);
        document.getElementById('Lavanderia').addEventListener('change', calcularTotal);

        function calcularTotal() {
            let tarifaOrdinaria = parseFloat(document.getElementById('TarifaOrdinaria').value) || 0;
            let tarifaEspecial = parseFloat(document.getElementById('TarifaEspecial').value) || 0;
            let diasOrdinarios = parseInt(document.getElementById('dias-ordinarios').value) || 0;
            let diasEspeciales = parseInt(document.getElementById('dias-especiales').value) || 0;
            let lavanderiaCosto = document.getElementById('Lavanderia').checked ? 50 : 0;

            let total = (diasOrdinarios * tarifaOrdinaria) + (diasEspeciales * tarifaEspecial) + lavanderiaCosto;
            document.getElementById('ValorTotal').value = total.toFixed(2);
        }
    </script>
}
